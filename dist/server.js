!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(0)),i=o(n(2)),c=o(n(3)),u=o(n(4)),s=o(n(5)),l=o(n(6)),a=o(n(7)),d=o(n(8)),f=o(n(9)),p=o(n(10)),g=o(n(11));r.default.config();const b=new i.default,k=new u.default.Server(b.callback()),m=new c.default,O=f.default(k,{pingInterval:1e4,pingTimeout:1e4,transports:["websocket","polling"],origins:"*:*",parser:p.default});console.log("socket io port:",Object({JWT_PRIVATE_KEY:"black2284"}).SOCKET_IO_PORT);const _=Number(Object({JWT_PRIVATE_KEY:"black2284"}).PORT)||Number(Object({JWT_PRIVATE_KEY:"black2284"}).SOCKET_IO_PORT)||5e3;Object({JWT_PRIVATE_KEY:"black2284"}).IP,Number(Object({JWT_PRIVATE_KEY:"black2284"}).NET_PORT);console.log("is dev:","production"),b.use(s.default());const v=[],y=[];function S(){console.log("접속 클라이언트들:"),y.map(e=>{console.log(`nickName:${e.nickName}, nickId:${e.nickId}, uniqueId:${e.uniqueId}`)})}let I;O.use((e,t)=>{const n=e.handshake.query;if(n&&n.token){const o=g.default(n.token);if(o.success){const{nickName:n,nickId:r}=o.info.data;return I={isRead:!0,nickName:n,nickId:r,uniqueId:e.id,unreadCount:0},t()}return console.log("미인증 토큰!"),t(new Error("AUTH_ERROR"))}}).on("connection",(e,t)=>{y.push({...I}),console.log("접속정보 SEND:",JSON.stringify(I)),e.broadcast.emit("client.user.in",JSON.stringify(I)),e.emit("client.current.users",JSON.stringify(y)),S(),e.on("disconnect",t=>{const n=a.default.find(y,{uniqueId:e.id});e.broadcast.emit("client.user.out",JSON.stringify(n)),a.default.remove(y,e=>e.uniqueId===n.uniqueId),console.log("client disconnected!",JSON.stringify(n))}),e.on("client.msg.send",t=>{console.log("client.msg.send:",t);const n=JSON.parse(t),o={...n,isSelf:!1};""===n.msgToUniqueId?e.broadcast.emit("client.msg.receive",JSON.stringify(o)):O.to(n.msgToUniqueId).emit("client.msg.receive",JSON.stringify(o))})}),m.get("*",(e,t)=>e.response.body="hello!"),b.use(m.routes()),k.listen(_,()=>{console.log(`> SOCKET.IO Server Listening! port:${_}`)}).on("error",e=>{throw e}),l.default.createServer(e=>{const t=e.remoteAddress+":"+e.remotePort;console.log("client connected:",t);const n={clientSocket:e,nickName:e.nickName,nickId:e.nickId,uniqueId:d.default(),socketName:"",socketGubun:"net"};e.write(JSON.stringify({action:"client.msg.connected",data:n.uniqueId})),v.push(n),S(),e.on("data",e=>{const t=e.toString();console.log("net data:",t),v.filter(e=>"socket.io"===e.socketGubun).map(e=>{e.clientSocket.emit("client.msg.receive",t)})}),e.on("close",()=>{console.log("NET Server Closed!"),a.default.remove(v,t=>t.clientSocket===e),S(),e.end("소켓 closed!")}),e.on("end",()=>{console.log("NET Socket Client end!")}),e.on("error",e=>{})}).on("connection",e=>{console.log("connected!"),S()})},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("uuid/v1")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("socket.io-msgpack-parser")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(12));o(n(0)).default.config();t.default=(e=>{try{return console.log("env:production"),console.log("privateKey:black2284"),{info:r.default.verify(e,"black2284"),success:!0}}catch(e){return{info:"",success:!1}}})},function(e,t){e.exports=require("jsonwebtoken")}]);